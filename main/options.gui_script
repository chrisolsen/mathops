local ui = require("main/ui")

function init(self)
	msg.post('.', 'acquire_input_focus')
	self.operator = '+'
	self.question_count = 25
end

function final(self)
	msg.post('.', 'release_input_focus')
end

function on_message(self, message_id, message)
	if hash('foo') == message_id then
		print('in the foo')
	end
end

function on_input(self, action_id, action)
	-- run twice to ensure the previous value is cleared
	for i=0,1 do
		self.operator = ui:radio('op_add', action_id, action, '+', self.operator)
		self.operator = ui:radio('op_minus', action_id, action, '-', self.operator)
		self.operator = ui:radio('op_times', action_id, action, 'x', self.operator)
		self.operator = ui:radio('op_divide', action_id, action, '/', self.operator)
	end

	self.question_count = ui:slider('question_count_slider', action_id, action, self.question_count, 1, 50)
	local count = gui.get_node('question_count:count')
	gui.set_text(count, tostring(self.question_count))

	if action_id == hash('touch') and action.pressed then
		local btn_back = gui.get_node('template/topbar_back')
		local btn = gui.get_node('btn:play/button')
		if gui.pick_node(btn, action.x, action.y) then
			msg.post("#", "disable")

			msg.post('default:/root#root', 'action', {
				action = 'game:load',
				data = {
					operator = self.operator,
					question_count = self.question_count
				}
			})

		elseif gui.pick_node(btn_back, action.x, action.y) then
			msg.post('default:/root#root', 'action', { action = 'landing:load' })
		end
	end
end
